@model SisyphusChat.Web.Models.CreateGroupChatViewModel

<head>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.0/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/user-status.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/creategroup.css" asp-append-version="true" />
</head>

<body>
    <form id="createGroupChatForm" asp-action="CreateGroupChat" asp-controller="GroupChat" method="post" class="max-w-lg mx-auto p-4 bg-white form-container">
        <h2 class="text-2xl font-bold mb-4 centered-heading">Create Group Chat</h2>

        <div class="form-group mb-4">
            <input id="groupName" name="ChatName" type="text" placeholder="Enter group name" class="form-control" asp-for="ChatName" />
            <span asp-validation-for="ChatName" class="text-danger text-red-500"></span>
        </div>

        <div class="mb-4">
            <div class="mb-4">
                <input type="text" id="searchInput" placeholder="Search users..." class="search-input mb-2" />
            </div>
            <ul id="userList">
                @foreach (var user in Model.Users)
                {
                    <li class="user-item mb-2" onclick="toggleCheckbox(this)">
                        <input type="checkbox" class="user-checkbox" value="@user.UserName" />
                        <span>@user.UserName</span>
                        <span class="user-status @(user.IsOnline ? "bg-green-500" : "bg-gray-500") w-3 h-3 rounded-full"></span>
                    </li>
                }
            </ul>
        </div>

        <div id="selectedUsersContainer" asp-for="SelectedUserNames"></div>
        <span asp-validation-for="SelectedUserNames" class="text-danger text-red-500"></span>

        <input type="hidden" name="OwnerId" value="@Model.OwnerId" />

        <div class="button-container">
            <button type="submit" class="create-chat-button">Create Group Chat</button>
        </div>
    </form>

    @section Scripts {
        <script type="text/javascript">
            function updateSelectedUsers() {
                const selectedUsers = Array.from(document.querySelectorAll('.user-checkbox:checked'))
                    .map(checkbox => checkbox.value);

                const container = document.getElementById('selectedUsersContainer');
                container.innerHTML = ''; // Clear previous inputs

                selectedUsers.forEach(user => {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'SelectedUserNames';
                    input.value = user;
                    container.appendChild(input);
                });
            }

            function toggleCheckbox(item) {
                const checkbox = item.querySelector('.user-checkbox');
                checkbox.checked = !checkbox.checked;
                updateSelectedUsers();
            }

            document.querySelectorAll('.user-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedUsers);
            });

            document.getElementById('searchInput').addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                const items = document.querySelectorAll("#userList .user-item");

                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        item.style.display = "";
                    } else {
                        item.style.display = "none";
                    }
                });
            });

            updateSelectedUsers();
        </script>

        <partial name="_ValidationScriptsPartial" />
    }
</body>